(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();function g(s){return window.go.main.App.AddProxy(s)}function l(s){return window.go.main.App.DeleteProxy(s)}function y(){return window.go.main.App.ExportConfigToFile()}function x(){return window.go.main.App.GetAllProxies()}function f(){return window.go.main.App.GetStats()}function E(){return window.go.main.App.ImportConfigFromFile()}function d(s){return window.go.main.App.StartProxy(s)}function a(s){return window.go.main.App.StopProxy(s)}function P(s){return window.go.main.App.UpdateProxy(s)}function w(s){window.runtime.BrowserOpenURL(s)}class B{constructor(){this.proxies=[],this.selectedProxies=new Set,this.currentEditingProxy=null,this.initializeElements(),this.bindEvents(),this.loadProxies(),setInterval(()=>this.loadProxies(),15e3)}initializeElements(){this.addBtn=document.getElementById("addBtn"),this.exportBtn=document.getElementById("exportBtn"),this.importBtn=document.getElementById("importBtn"),this.selectAllBtn=document.getElementById("selectAllBtn"),this.startSelectedBtn=document.getElementById("startSelectedBtn"),this.stopSelectedBtn=document.getElementById("stopSelectedBtn"),this.deleteSelectedBtn=document.getElementById("deleteSelectedBtn"),this.selectedCount=document.getElementById("selectedCount"),this.totalCount=document.getElementById("totalCount"),this.runningCount=document.getElementById("runningCount"),this.proxyList=document.getElementById("proxyList"),this.modal=document.getElementById("proxyModal"),this.modalContent=document.querySelector(".modal-content"),this.modalTitle=document.getElementById("modalTitle"),this.proxyForm=document.getElementById("proxyForm"),this.closeBtn=document.querySelector(".close"),this.cancelBtn=document.getElementById("cancelBtn")}bindEvents(){this.addBtn.addEventListener("click",()=>this.showAddModal()),this.exportBtn.addEventListener("click",()=>this.exportConfig()),this.importBtn.addEventListener("click",()=>this.importConfig()),this.selectAllBtn.addEventListener("change",()=>this.toggleSelectAll()),this.startSelectedBtn.addEventListener("click",()=>this.startSelectedProxies()),this.stopSelectedBtn.addEventListener("click",()=>this.stopSelectedProxies()),this.deleteSelectedBtn.addEventListener("click",()=>this.deleteSelectedProxies()),this.closeBtn.addEventListener("click",()=>this.hideModal()),this.cancelBtn.addEventListener("click",()=>this.hideModal()),this.modalContent&&this.modalContent.addEventListener("click",e=>{e.stopPropagation()}),this.proxyForm.addEventListener("submit",e=>this.handleFormSubmit(e)),document.addEventListener("keydown",e=>this.handleKeyDown(e)),this.bindExternalLinks()}bindExternalLinks(){document.addEventListener("click",e=>{e.target.tagName==="A"&&e.target.href&&(e.preventDefault(),this.openExternalLink(e.target.href))})}handleKeyDown(e){e.key==="Escape"&&this.modal.classList.contains("show")&&(e.preventDefault(),e.stopPropagation())}openExternalLink(e){try{w(e)}catch(t){console.error("\u6253\u5F00\u5916\u90E8\u94FE\u63A5\u5931\u8D25:",t),window.open(e,"_blank")}}async loadProxies(){try{const[e,t]=await Promise.all([x(),f()]);this.proxies=e||[],this.updateProxyList(),this.updateStats(t),this.updateSelectionUI()}catch(e){if(this.lastErrorTime&&Date.now()-this.lastErrorTime<3e4)return;this.lastErrorTime=Date.now(),console.error("\u52A0\u8F7D\u4EE3\u7406\u5931\u8D25:",e)}}updateProxyList(){if(this.proxyList.innerHTML="",this.proxies.length===0){this.proxyList.innerHTML='<div style="text-align: center; padding: 2rem; color: #6b7280;"><p>\u6682\u65E0\u4EE3\u7406\u914D\u7F6E</p></div>';return}this.proxies.forEach(e=>{const t=this.createProxyElement(e);this.proxyList.appendChild(t)})}createProxyElement(e){const t=document.createElement("div");t.className="proxy-item";const n=this.selectedProxies.has(e.id),o=e.running?"status-running":"status-stopped",i=e.running?"\u8FD0\u884C\u4E2D":"\u5DF2\u505C\u6B62",r=e.running?"\u505C\u6B62":"\u542F\u52A8",c=e.running?"btn-danger":"btn-success";t.innerHTML=`
            <div class="proxy-checkbox">
                <input type="checkbox" ${n?"checked":""} data-id="${e.id}">
            </div>
            <div class="proxy-info">
                <div class="proxy-name" title="${e.name}">${e.name}</div>
                <div class="proxy-endpoints-compact">
                    \u4E0A\u6E38: ${e.upstream.protocol}://${e.upstream.address} | \u672C\u5730: ${e.local.protocol}://${e.local.listen_ip}:${e.local.listen_port}
                </div>
                <div class="proxy-status-inline ${o}">
                    <div class="status-dot"></div>
                    <span>${i}</span>
                </div>
            </div>
            <div class="proxy-actions-inline">
                <button class="btn ${c} toggle-btn" data-id="${e.id}">${r}</button>
                <button class="btn btn-outline edit-btn" data-id="${e.id}">\u7F16\u8F91</button>
                <button class="btn btn-danger delete-btn" data-id="${e.id}">\u5220\u9664</button>
            </div>
        `;const u=t.querySelector('input[type="checkbox"]'),h=t.querySelector(".toggle-btn"),m=t.querySelector(".edit-btn"),p=t.querySelector(".delete-btn");return u.addEventListener("change",()=>this.toggleProxySelection(e.id)),h.addEventListener("click",()=>this.toggleProxy(e.id,e.running)),m.addEventListener("click",()=>this.showEditModal(e)),p.addEventListener("click",()=>this.deleteProxy(e.id,e.name)),t}updateStats(e){this.totalCount.textContent=e.total||0,this.runningCount.textContent=e.running||0}toggleSelectAll(){this.selectAllBtn.checked?this.proxies.forEach(e=>this.selectedProxies.add(e.id)):this.selectedProxies.clear(),this.updateProxyList(),this.updateSelectionUI()}toggleProxySelection(e){this.selectedProxies.has(e)?this.selectedProxies.delete(e):this.selectedProxies.add(e),this.updateSelectionUI()}updateSelectionUI(){const e=this.selectedProxies.size,t=this.proxies.length;this.selectedCount.textContent=`\u5DF2\u9009\u62E9 ${e} \u9879`,this.selectAllBtn.checked=e===t&&t>0,this.selectAllBtn.indeterminate=e>0&&e<t,this.startSelectedBtn.disabled=e===0,this.stopSelectedBtn.disabled=e===0,this.deleteSelectedBtn.disabled=e===0}async startSelectedProxies(){const e=Array.from(this.selectedProxies);if(e.length!==0){for(const t of e)try{await d(t)}catch(n){console.error(`\u542F\u52A8\u4EE3\u7406 ${t} \u5931\u8D25:`,n)}await this.loadProxies()}}async stopSelectedProxies(){const e=Array.from(this.selectedProxies);if(e.length!==0){for(const t of e)try{await a(t)}catch(n){console.error(`\u505C\u6B62\u4EE3\u7406 ${t} \u5931\u8D25:`,n)}await this.loadProxies()}}async deleteSelectedProxies(){const e=Array.from(this.selectedProxies);if(e.length===0)return;const t=e.map(n=>{const o=this.proxies.find(i=>i.id===n);return o?o.name:n});if(!!confirm(`\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ${e.length} \u4E2A\u4EE3\u7406\u5417\uFF1F
${t.join(", ")}`)){for(const n of e)try{await l(n),this.selectedProxies.delete(n)}catch(o){console.error(`\u5220\u9664\u4EE3\u7406 ${n} \u5931\u8D25:`,o)}await this.loadProxies()}}async toggleProxy(e,t){try{t?await a(e):await d(e),await this.loadProxies()}catch(n){console.error("\u5207\u6362\u4EE3\u7406\u72B6\u6001\u5931\u8D25:",n)}}async deleteProxy(e,t){if(!!confirm(`\u786E\u5B9A\u8981\u5220\u9664\u4EE3\u7406 "${t}" \u5417\uFF1F`))try{await l(e),this.selectedProxies.delete(e),await this.loadProxies()}catch(n){console.error("\u5220\u9664\u4EE3\u7406\u5931\u8D25:",n)}}showAddModal(){this.modalTitle.textContent="\u6DFB\u52A0\u65B0\u4EE3\u7406",this.currentEditingProxy=null,this.proxyForm.reset(),document.getElementById("localIP").value="127.0.0.1",document.getElementById("proxyEnabled").checked=!0,this.showModal()}showEditModal(e){this.modalTitle.textContent="\u7F16\u8F91\u4EE3\u7406",this.currentEditingProxy=e,document.getElementById("proxyName").value=e.name,document.getElementById("upstreamProtocol").value=e.upstream.protocol,document.getElementById("upstreamAddress").value=e.upstream.address,document.getElementById("upstreamUsername").value=e.upstream.username||"",document.getElementById("upstreamPassword").value=e.upstream.password||"",document.getElementById("localProtocol").value=e.local.protocol,document.getElementById("localIP").value=e.local.listen_ip,document.getElementById("localPort").value=e.local.listen_port,document.getElementById("proxyEnabled").checked=e.enabled,this.showModal()}showModal(){this.modal.classList.add("show")}hideModal(){this.modal.classList.remove("show"),this.currentEditingProxy=null}async handleFormSubmit(e){e.preventDefault();try{const t=new FormData(this.proxyForm),n={id:this.currentEditingProxy?this.currentEditingProxy.id:"",name:t.get("name"),upstream:{protocol:t.get("upstream.protocol"),address:t.get("upstream.address"),username:t.get("upstream.username")||"",password:t.get("upstream.password")||"",auth_method:"basic"},local:{protocol:t.get("local.protocol"),listen_ip:t.get("local.listen_ip"),listen_port:parseInt(t.get("local.listen_port"))},enabled:document.getElementById("proxyEnabled").checked};this.currentEditingProxy?await P(n):await g(n),this.hideModal(),await this.loadProxies()}catch(t){console.error("\u4FDD\u5B58\u4EE3\u7406\u5931\u8D25:",t)}}async exportConfig(){try{await y()}catch(e){console.error("\u5BFC\u51FA\u914D\u7F6E\u5931\u8D25:",e)}}importConfig(){this.importConfigFromFile()}async importConfigFromFile(){try{await E(),await this.loadProxies()}catch(e){console.error("\u5BFC\u5165\u914D\u7F6E\u5931\u8D25:",e)}}}document.addEventListener("DOMContentLoaded",()=>{new B});
